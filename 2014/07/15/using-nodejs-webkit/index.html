<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Using nodejs to develop desktop app · 光光的小站</title><meta name="description" content="Using nodejs to develop desktop app - Tony Wang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://esfak47.github.io/atom.xml" title="光光的小站"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/6327633239" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/esfak47" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Using nodejs to develop desktop app</h1><div class="post-info">Jul 15, 2014</div><div class="post-content"><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><h3 id="一、node-webkit是什么？"><a href="#一、node-webkit是什么？" class="headerlink" title="一、node-webkit是什么？"></a>一、node-webkit是什么？</h3><h3 id="二、node-webkit有些什么干货？"><a href="#二、node-webkit有些什么干货？" class="headerlink" title="二、node-webkit有些什么干货？"></a>二、node-webkit有些什么干货？</h3><h3 id="三、node-webkit的基本工作原理是怎样的？"><a href="#三、node-webkit的基本工作原理是怎样的？" class="headerlink" title="三、node-webkit的基本工作原理是怎样的？"></a>三、node-webkit的基本工作原理是怎样的？</h3><h3 id="四、怎样用node-webkit进行客户端开发？"><a href="#四、怎样用node-webkit进行客户端开发？" class="headerlink" title="四、怎样用node-webkit进行客户端开发？"></a>四、怎样用node-webkit进行客户端开发？</h3><h3 id="五、如何做到开发一份代码，生成多平台APP？"><a href="#五、如何做到开发一份代码，生成多平台APP？" class="headerlink" title="五、如何做到开发一份代码，生成多平台APP？"></a>五、如何做到开发一份代码，生成多平台APP？</h3><h3 id="六、使用node-webkit开发桌面客户端的优缺点？"><a href="#六、使用node-webkit开发桌面客户端的优缺点？" class="headerlink" title="六、使用node-webkit开发桌面客户端的优缺点？"></a>六、使用node-webkit开发桌面客户端的优缺点？</h3><h3 id="七、Q-amp-A"><a href="#七、Q-amp-A" class="headerlink" title="七、Q &amp; A!"></a>七、Q &amp; A!</h3><h3 id="一、node-webkit是什么？-1"><a href="#一、node-webkit是什么？-1" class="headerlink" title="一、node-webkit是什么？"></a>一、node-webkit是什么？</h3><h4 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h4><p>基于node.js和chromium的应用程序实时运行环境，可运行通过HTML(5)、CSS(3)、Javascript来编写的本地应用程序。node.js和webkit的结合体，webkit提供DOM操作，node.js提供本地化操作；且将二者的context完全整合，可在HTML代码中直接使用node.js的API。</p>
<h4 id="2、获取node-webkit"><a href="#2、获取node-webkit" class="headerlink" title="2、获取node-webkit"></a>2、获取node-webkit</h4><p>官网：<a href="https://github.com/rogerwang/node-webkit" target="_blank" rel="noopener">https://github.com/rogerwang/node-webkit</a></p>
<p>支持的平台：Windows 32bit，Linux 32/64bit，Mac 32bit(OS X 10.7+)</p>
<p>选择与平台相对应的版本，下载并安装即可。</p>
<h3 id="二、node-webkit有些什么干货？-1"><a href="#二、node-webkit有些什么干货？-1" class="headerlink" title="二、node-webkit有些什么干货？"></a>二、node-webkit有些什么干货？</h3><p>官方提供的一些成品：<a href="https://github.com/rogerwang/node-webkit/wiki/List-of-apps-and-companies-using-node-webkit" target="_blank" rel="noopener">https://github.com/rogerwang/node-webkit/wiki/List-of-apps-and-companies-using-node-webkit</a></p>
<h3 id="三、node-webkit的基本工作原理是怎样的？-1"><a href="#三、node-webkit的基本工作原理是怎样的？-1" class="headerlink" title="三、node-webkit的基本工作原理是怎样的？"></a>三、node-webkit的基本工作原理是怎样的？</h3><p>webkit提供DOM操作，包括HTML解析、CSS渲染、Javascript解释执行、DOM事件处理等。而node.js则提供一些本地化的操作、服务器端的处理等。二者的上下文完全融合，实现一个较为完美的本地应用环境。</p>
<h3 id="四、怎样用node-webkit进行客户端开发？-1"><a href="#四、怎样用node-webkit进行客户端开发？-1" class="headerlink" title="四、怎样用node-webkit进行客户端开发？"></a>四、怎样用node-webkit进行客户端开发？</h3><h4 id="1、一个node-webkit项目的基本目录结构"><a href="#1、一个node-webkit项目的基本目录结构" class="headerlink" title="1、一个node-webkit项目的基本目录结构"></a>1、一个node-webkit项目的基本目录结构</h4><p>上面这是一个简单nw应用的目录结构，如果nw应用中需要用到额外的node_module，可以在目录结构中增加一个node_modules的目录，以存放APP所需的node插件。</p>
<p>其实，一个最最简单的nw应用，只需要有mail.html和package.json文件即可，如下：</p>
<h4 id="2、认识package-json"><a href="#2、认识package-json" class="headerlink" title="2、认识package.json"></a>2、认识package.json</h4><p>“Every app package should contain a manifest file named package.json, it will tell node-webkit how to open the app and control how the browser behaves. ”</p>
<p>package.json格式如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "main": "main.html",                              /* APP的主入口，文件名任意；必选 */</span><br><span class="line">    "name": "nw-demo",                                /* APP的名称，必须具备唯一性，且符合正常变量命名；必选 */</span><br><span class="line">    "description": "demo app of node-webkit",         /* APP的简单描述 */</span><br><span class="line">    "version": "0.1.0",                               /* APP的版本号 */</span><br><span class="line">    "keywords": [ "demo", "node-webkit" ],            /* APP的关键字，搜索APP时用到 */</span><br><span class="line">    "window": &#123;                                       /* APP的窗口属性 */</span><br><span class="line">        "icon": "link.png",                           /* APP图标（windows下，状态栏上可见） */</span><br><span class="line">        "toolbar": true,                              /* 是否显示工具栏 */</span><br><span class="line">        "width": 800,                                 /* 窗口初始化大小 */</span><br><span class="line">        "height": 500,</span><br><span class="line">        "frame": true                                 /* 是否显示外窗体，如最大化、最小化、关闭按钮 */</span><br><span class="line">    &#125;,</span><br><span class="line">    "user-agent": "%name %ver %nwver %webkit_ver %osinfo" /* 可自定义APP的UA */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中，main和name是必选字段，更多配置字段，可参考官方地址：<a href="https://github.com/rogerwang/node-webkit/wiki/Manifest-Format" target="_blank" rel="noopener">https://github.com/rogerwang/node-webkit/wiki/Manifest-Format</a></p>
<h4 id="3、主窗口mail-html的写法"><a href="#3、主窗口mail-html的写法" class="headerlink" title="3、主窗口mail.html的写法"></a>3、主窗口mail.html的写法</h4><p>随意写，和普通的前端页面开发方式一样！</p>
<h4 id="4、最简单的HelloWorld"><a href="#4、最简单的HelloWorld" class="headerlink" title="4、最简单的HelloWorld"></a>4、最简单的HelloWorld</h4><p>Create <code>index.html</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    We are using node.js <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.version)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Create <code>package.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"nw-demo"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Compress <code>index.html</code> and <code>package.json</code> into a zip archive called <code>app.nw</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ zip app.nw index.html package.json</span><br></pre></td></tr></table></figure>
<p>This should create a structure like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.nw</span><br><span class="line">|-- package.json</span><br><span class="line">`-- index.html</span><br></pre></td></tr></table></figure>
<p>Download the prebuilt binary for your platform and use it to open the<br><code>app.nw</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./nw app.nw</span><br></pre></td></tr></table></figure>
<p>也许你会觉得这个界面特别熟悉，没错，它就是chromium！只是在node-webkit中，我们可以通过修改package.json配置，把工具栏和外框去掉，修改后的配置为：</p>
<p>去掉外框后的运行效果：</p>
<p>你一定会发现去掉toolbar和frame以后，窗口没法被拖动了，其实，可以通过下面这句css来实现窗口可拖动：</p>
<h3 id="五、如何做到开发一份代码，生成多平台APP？-1"><a href="#五、如何做到开发一份代码，生成多平台APP？-1" class="headerlink" title="五、如何做到开发一份代码，生成多平台APP？"></a>五、如何做到开发一份代码，生成多平台APP？</h3><h4 id="1、nw包制作"><a href="#1、nw包制作" class="headerlink" title="1、nw包制作"></a>1、nw包制作</h4><p>完成上面的操作，已经生成了一个名为hello-world.nw的文件，如果本机已经安装过node-webkit，双击该文件即可运行。但是，针对未安装过node-webkit的用户，还需要将此nw的运行环境也打包在一起，并生成通用可执行文件，Mac上<em>.app，Windows上</em>.exe。</p>
<h4 id="2、针对Mac-OS-X，-app文件制作"><a href="#2、针对Mac-OS-X，-app文件制作" class="headerlink" title="2、针对Mac OS X，*.app文件制作"></a>2、针对Mac OS X，*.app文件制作</h4><p>a）、app.icns文件制作</p>
<p>为你的App制作特定图标，可准备一张1024*1024的png图片，利用icns-Tool工具生成app.icns图标文件。</p>
<p>b）、修改Info.plist文件</p>
<p>为你的App制作或修改特定的描述文件。</p>
<p>c）、打包*.app</p>
<p>从官网再次下载node-webkit的Mac版，命令行执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mv hello-world.nw app.nw </span><br><span class="line">cp app.nw node-webkit.app/Contents/Resources/</span><br><span class="line">cp app.icns node-webkit.app/Contents/Resources/</span><br><span class="line">cp Info.plist node-webkit.app/Contents/</span><br><span class="line">mv node-webkit.app hello-wrold.app</span><br></pre></td></tr></table></figure></p>
<p>至此，Mac OS X版本的可执行程序hello-world.app制作完成。</p>
<p>一般情况下，都会将其压缩后再进行传播。</p>
<h4 id="3）、针对Windows，-exe文件制作"><a href="#3）、针对Windows，-exe文件制作" class="headerlink" title="3）、针对Windows，*.exe文件制作"></a>3）、针对Windows，*.exe文件制作</h4><p>windows版本的exe程序制作非常容易，从官网下载node-webkit.exe，cmd下执行：<br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">copy</span> /b node-webkit.exe+app.exe hello-world.exe</span><br></pre></td></tr></table></figure></p>
<p>在Linux环境下，可以使用如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat node-webkit.exe app.exe &gt; hello-world.exe</span><br></pre></td></tr></table></figure></p>
<p>至此，Windows版本的hello-world.exe程序制作完成。</p>
<p>4）、将繁琐重复的操作整合到一个build.sh脚本中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! sh</span></span><br><span class="line">app_name=<span class="string">"system-info"</span></span><br><span class="line"><span class="comment"># 创建app.nw文件</span></span><br><span class="line"><span class="built_in">cd</span> ../ &amp;&amp; rm -rf output &amp;&amp; mkdir output cp</span><br><span class="line">rm -rf output</span><br><span class="line">-r <span class="variable">$app_name</span>/* output</span><br><span class="line">rm -rf output/Info.plist output/build.sh output/app.icns</span><br><span class="line"><span class="built_in">cd</span> output/</span><br><span class="line">find . -<span class="built_in">type</span> d -name <span class="string">".svn"</span> | xargs rm -rf</span><br><span class="line">zip -r ../app.nw * &gt; /dev/null;</span><br><span class="line">rm -rf * &amp;&amp; <span class="built_in">cd</span> ../ &amp;&amp; mv app.nw output/</span><br><span class="line">mv output <span class="variable">$app_name</span>/ &amp;&amp; <span class="built_in">cd</span> <span class="variable">$app_name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"create nw file success!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#下载基础包</span></span><br><span class="line">svn co svn://localhost/node-webkit-base output &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建mac版本app</span></span><br><span class="line"><span class="built_in">cd</span> output</span><br><span class="line">unzip mac-os-x.zip -d mac-os-x &gt; /dev/null</span><br><span class="line">rm -rf mac-os-x.zip mac-os-x/nwsnapshot</span><br><span class="line"><span class="keyword">if</span> [ -f ../Info.plist ];<span class="keyword">then</span></span><br><span class="line">cp ../Info.plist mac-os-x/node-webkit.app/Contents/</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">cp app.nw mac-os-x/node-webkit.app/Contents/Resources/</span><br><span class="line"><span class="keyword">if</span> [ -f ../app.icns ];<span class="keyword">then</span></span><br><span class="line">cp ../app.icns mac-os-x/node-webkit.app/Contents/Resources/</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">mv mac-os-x/node-webkit.app mac-os-x/<span class="variable">$app_name</span>.app</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"create mac os app success!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建windows版本app</span></span><br><span class="line">unzip win-32.zip -d win-32 &gt; /dev/null</span><br><span class="line">rm -rf win-32.zip win-32/nwsnapshot</span><br><span class="line">cp app.nw win-32/ &amp;&amp; <span class="built_in">cd</span> win-32</span><br><span class="line">cat nw.exe app.nw &gt; <span class="variable">$app_name</span>.exe</span><br><span class="line">rm -rf nw.exe nwsnapshot.exe</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"create windows app success!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除app.nw</span></span><br><span class="line">rm -f app.nw</span><br></pre></td></tr></table></figure></p>
<h3 id="六、使用node-webkit开发桌面客户端的优缺点？-1"><a href="#六、使用node-webkit开发桌面客户端的优缺点？-1" class="headerlink" title="六、使用node-webkit开发桌面客户端的优缺点？"></a>六、使用node-webkit开发桌面客户端的优缺点？</h3><p>1、优点</p>
<ul>
<li>提高UI开发效率，DOM中丰富的事件等可以涵盖绝大多数桌面开发中的情况</li>
<li>HTML(5)与CSS(3)拥有丰富的展现效果，可以更容易地对界面进行改版、换肤</li>
<li>容易实现跨平台:Mac OS X 、Windows、Linux</li>
<li>使用Web开发人员工具可以使 UI 调试变得很轻松</li>
<li>桌面程序UI与Web版UI可以共享代码</li>
</ul>
<p>2）、缺点</p>
<ul>
<li>浏览器原生API几乎仅仅局限在Web页面上</li>
<li>若通过JavaScript引擎向Web前端暴露一些具有操作客户端权限的API，如何保证代码安全性</li>
<li>必须携带浏览器内核运行库，无形增加程序体积，至少20MB以上（压缩后）</li>
<li>能否满足各种复杂怪异的需求，比如异型窗口</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/08/hello-world/" class="prev">PREV</a><a href="/2014/07/14/basic-tcl-command/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://esfak47.github.io">Tony Wang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>