<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Canvas API · 光光的小站</title><meta name="description" content="Canvas API - Tony Wang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://esfak47.github.io/atom.xml" title="光光的小站"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/6327633239" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/esfak47" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Canvas API</h1><div class="post-info">Jan 8, 2018</div><div class="post-content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Canvas用于在网页展示图像，并且可以定制内容，基本上它是一个可以用JavaScript操作的位图（bitmap）。<br>Canvas API用于网页实时生成图像，JavaScript通过API来操作图像内容。这样做的优点是：减少HTTP请求数，减少下载的数据，加快网页载入时间，可以对图像进行实时处理。<br>使用前，首先需要新建一个canvas网页元素。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"myCanvas"</span> <span class="attr">width</span>=<span class="string">"400"</span> <span class="attr">height</span>=<span class="string">"200"</span>&gt;</span></span><br><span class="line">	您的浏览器不支持canvas！</span><br><span class="line"><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果浏览器不支持这个API，则就会显示canvas标签中间的文字——“您的浏览器不支持canvas！”。</p>
<p>然后，使用JavaScript获取canvas的DOM对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'myCanvas'</span>);</span><br></pre></td></tr></table></figure>
<p>接着，检查浏览器是否支持Canvas API，方法是看有没有部署getContext方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (canvas.getContext) &#123;</span><br><span class="line">	<span class="comment">// some code here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用getContext(‘2d’)方法，初始化平面图像的上下文环境。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br></pre></td></tr></table></figure>
<p>现在就在canvas中间生成平面图像了。</p>
<h2 id="绘图方法"><a href="#绘图方法" class="headerlink" title="绘图方法"></a>绘图方法</h2><p>（1）填充颜色</p>
<p>设置填充颜色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.fillStyle = <span class="string">"#000000"</span>; <span class="comment">// 设置填充色为黑色</span></span><br></pre></td></tr></table></figure>
<p>（2）绘制矩形</p>
<p>绘制实心矩形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>绘制空心矩形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.strokeRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>清除某个矩形区域的内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.clearRect(<span class="number">100</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>);</span><br></pre></td></tr></table></figure>
<p>（3）绘制路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ctx.beginPath(); <span class="comment">// 开始路径绘制</span></span><br><span class="line">ctx.moveTo(<span class="number">20</span>, <span class="number">20</span>); <span class="comment">// 设置路径起点</span></span><br><span class="line">ctx.lineTo(<span class="number">200</span>, <span class="number">20</span>); <span class="comment">// 绘制一条到200, 20的直线</span></span><br><span class="line">ctx.lineWidth = <span class="number">1.0</span>; <span class="comment">// 设置线宽</span></span><br><span class="line">ctx.strokeStyle = <span class="string">"#CC0000"</span>; <span class="comment">// 设置线的颜色</span></span><br><span class="line">ctx.stroke(); <span class="comment">// 进行线的着色，这时整条线才变得可见</span></span><br></pre></td></tr></table></figure>
<p>moveto和lineto方法可以多次使用。最后，还可以使用closePath方法，自动绘制一条当前点到起点的直线，形成一个封闭图形，省却使用以此lineto方法。</p>
<p>（4）绘制圆形和扇形</p>
<p>绘制扇形的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.arc(x, y, radius, startAngle, endAngle, anticlockwise);</span><br></pre></td></tr></table></figure>
<p>arc方法的x和y参数是圆心坐标，radius是半径，startAngle和endAngle则是扇形的起始角度和终止角度（以弧度表示），anticlockwise表示做图时应该逆时针画（true）还是顺时针画（false）。</p>
<p>绘制实心的圆形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctx.beginPath(); </span><br><span class="line">ctx.arc(<span class="number">60</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>, <span class="literal">true</span>); </span><br><span class="line">ctx.fillStyle = <span class="string">"#000000"</span>; </span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure>
<p>绘制空心圆形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctx.beginPath(); </span><br><span class="line">ctx.arc(<span class="number">60</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>, <span class="literal">true</span>); </span><br><span class="line">ctx.lineWidth = <span class="number">1.0</span>; </span><br><span class="line">ctx.strokeStyle = <span class="string">"#000"</span>; </span><br><span class="line">ctx.stroke();</span><br></pre></td></tr></table></figure>
<p>（5）绘制文本</p>
<p>fillText方法用于添加文本，strokeText方法用于添加空心字。使用之前，需设定字体、对齐方向、颜色等属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctx.font = <span class="string">"Bold 20px Arial"</span>; <span class="comment">// 设置字体</span></span><br><span class="line">ctx.textAlign = <span class="string">"left"</span>; <span class="comment">// 设置对齐方式</span></span><br><span class="line">ctx.fillStyle = <span class="string">"#008600"</span>; <span class="comment">// 设置填充颜色</span></span><br><span class="line">ctx.fillText(<span class="string">"Hello!"</span>, <span class="number">10</span>, <span class="number">50</span>); <span class="comment">// 设置字体内容，以及在画布上的位置</span></span><br><span class="line">ctx.strokeText(<span class="string">'Hello!", 10, 100); // 绘制空心字</span></span><br></pre></td></tr></table></figure>
<p>fillText方法不支持文本断行，即所有文本出现在一行内。所以，如果你要生成多行文本，只有调用多次fillText方法。</p>
<h3 id="渐变"><a href="#渐变" class="headerlink" title="渐变"></a>渐变</h3><p>设置渐变色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myGradient = ctx.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">160</span>); </span><br><span class="line">myGradient.addColorStop(<span class="number">0</span>, <span class="string">"#BABABA"</span>); </span><br><span class="line">myGradient.addColorStop(<span class="number">1</span>, <span class="string">"#636363"</span>);</span><br></pre></td></tr></table></figure>
<p>createLinearGradient方法的参数是(x1, y1, x2, y2)，其中x1和y1是起点坐标，x2和y2是终点坐标。通过不同的坐标值，可以生成从上至下、从左到右的渐变等等。</p>
<p>使用方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx.fillStyle = myGradient;</span><br><span class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<h3 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ctx.shadowOffsetX = <span class="number">10</span>; <span class="comment">// 设置水平位移</span></span><br><span class="line">ctx.shadowOffsetY = <span class="number">10</span>; <span class="comment">// 设置垂直位移</span></span><br><span class="line">ctx.shadowBlur = <span class="number">5</span>; <span class="comment">// 设置模糊度</span></span><br><span class="line">ctx.shadowColor = <span class="string">"rgba(0,0,0,0.5)"</span>; <span class="comment">// 设置阴影颜色</span></span><br><span class="line">ctx.fillStyle = <span class="string">"#CC0000"</span>; </span><br><span class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<h2 id="图像处理方法"><a href="#图像处理方法" class="headerlink" title="图像处理方法"></a>图像处理方法</h2><h3 id="插入图像"><a href="#插入图像" class="headerlink" title="插入图像"></a>插入图像</h3><p>canvas允许将图像文件插入画布，做法是读取图片后，使用drawImage方法在画布内进行重绘。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">img.src = <span class="string">"image.png"</span>;</span><br><span class="line">ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 设置对应的图像对象，以及它在画布上的位置</span></span><br></pre></td></tr></table></figure>
<p>由于图像的载入需要时间，drawImage方法只能在图像完全载入后才能调用，因此上面的代码需要改写。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Image(); </span><br><span class="line">image.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">	<span class="keyword">if</span> (image.width != canvas.width)</span><br><span class="line">        canvas.width = image.width;</span><br><span class="line">    <span class="keyword">if</span> (image.height != canvas.height)</span><br><span class="line">        canvas.height = image.height;</span><br><span class="line">	ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">    ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125; </span><br><span class="line">image.src = <span class="string">"image.png"</span>;</span><br></pre></td></tr></table></figure>
<p>drawImage()方法接受三个参数，第一个参数是图像文件的DOM元素（即img标签），第二个和第三个参数是图像左上角在Canvas元素中的坐标，上例中的（0, 0）就表示将图像左上角放置在Canvas元素的左上角。</p>
<h3 id="读取Canvas的内容"><a href="#读取Canvas的内容" class="headerlink" title="读取Canvas的内容"></a>读取Canvas的内容</h3><p>getImageData方法可以用来读取Canvas的内容，返回一个对象，包含了每个像素的信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> imageData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br></pre></td></tr></table></figure>
<p>imageData对象有一个data属性，它的值是一个一维数组。该数组的值，依次是每个像素的红、绿、蓝、alpha通道值，因此该数组的长度等于 图像的像素宽度 x 图像的像素高度 x 4，每个值的范围是0–255。这个数组不仅可读，而且可写，因此通过操作这个数组的值，就可以达到操作图像的目的。修改这个数组以后，使用putImageData方法将数组内容重新回Canvas。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.putImageData(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="像素处理"><a href="#像素处理" class="headerlink" title="像素处理"></a>像素处理</h3><p>假定filter是一个处理像素的函数，那么整个对Canvas的处理流程，可以用下面的代码表示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (canvas.width &gt; <span class="number">0</span> &amp;&amp; canvas.height &gt; <span class="number">0</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> imageData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">    filter(imageData);</span><br><span class="line">    context.putImageData(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是几种常见的处理方法。</p>
<p>（1）灰度效果</p>
<p>灰度图（grayscale）就是取红、绿、蓝三个像素值的算术平均值，这实际上将图像转成了黑白形式。假定d[i]是像素数组中一个象素的红色值，则d[i+1]为绿色值，d[i+2]为蓝色值，d[i+3]就是alpha通道值。转成灰度的算法，就是将红、绿、蓝三个值相加后除以3，再将结果写回数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">grayscale = <span class="function"><span class="keyword">function</span> (<span class="params">pixels</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> d = pixels.data;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> r = d[i];</span><br><span class="line">      <span class="keyword">var</span> g = d[i + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">var</span> b = d[i + <span class="number">2</span>];</span><br><span class="line">      d[i] = d[i + <span class="number">1</span>] = d[i + <span class="number">2</span>] = (r+g+b)/<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pixels;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>（2）复古效果</p>
<p>复古效果（sepia）则是将红、绿、蓝三个像素，分别取这三个值的某种加权平均值，使得图像有一种古旧的效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sepia = <span class="function"><span class="keyword">function</span> (<span class="params">pixels</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = pixels.data;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> r = d[i];</span><br><span class="line">      <span class="keyword">var</span> g = d[i + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">var</span> b = d[i + <span class="number">2</span>];</span><br><span class="line">      d[i]     = (r * <span class="number">0.393</span>)+(g * <span class="number">0.769</span>)+(b * <span class="number">0.189</span>); <span class="comment">// red</span></span><br><span class="line">      d[i + <span class="number">1</span>] = (r * <span class="number">0.349</span>)+(g * <span class="number">0.686</span>)+(b * <span class="number">0.168</span>); <span class="comment">// green</span></span><br><span class="line">      d[i + <span class="number">2</span>] = (r * <span class="number">0.272</span>)+(g * <span class="number">0.534</span>)+(b * <span class="number">0.131</span>); <span class="comment">// blue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pixels;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>（3）红色蒙版效果</p>
<p>红色蒙版指的是，让图像呈现一种偏红的效果。算法是将红色通道设为红、绿、蓝三个值的平均值，而将绿色通道和蓝色通道都设为0。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">red = <span class="function"><span class="keyword">function</span> (<span class="params">pixels</span>) </span>&#123;	</span><br><span class="line">    <span class="keyword">var</span> d = pixels.data;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> r = d[i];</span><br><span class="line">      <span class="keyword">var</span> g = d[i + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">var</span> b = d[i + <span class="number">2</span>];</span><br><span class="line">      d[i] = (r+g+b)/<span class="number">3</span>;        <span class="comment">// 红色通道取平均值</span></span><br><span class="line">      d[i + <span class="number">1</span>] = d[i + <span class="number">2</span>] = <span class="number">0</span>; <span class="comment">// 绿色通道和蓝色通道都设为0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pixels;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>（4）亮度效果</p>
<p>亮度效果（brightness）是指让图像变得更亮或更暗。算法将红色通道、绿色通道、蓝色通道，同时加上一个正值或负值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">brightness = <span class="function"><span class="keyword">function</span> (<span class="params">pixels, delta</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = pixels.data;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">          d[i] += delta;     <span class="comment">// red</span></span><br><span class="line">          d[i + <span class="number">1</span>] += delta; <span class="comment">// green</span></span><br><span class="line">          d[i + <span class="number">2</span>] += delta; <span class="comment">// blue   </span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> pixels;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>（5）反转效果</p>
<p>反转效果（invert）是值图片呈现一种色彩颠倒的效果。算法为红、绿、蓝通道都取各自的相反值（255-原值）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">invert = <span class="function"><span class="keyword">function</span> (<span class="params">pixels</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> d = pixels.data;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">		d[i] = <span class="number">255</span> - d[i];</span><br><span class="line">		d[i+<span class="number">1</span>] = <span class="number">255</span> - d[i + <span class="number">1</span>];</span><br><span class="line">		d[i+<span class="number">2</span>] = <span class="number">255</span> - d[i + <span class="number">2</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> pixels;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="将Canvas转化为图像文件"><a href="#将Canvas转化为图像文件" class="headerlink" title="将Canvas转化为图像文件"></a>将Canvas转化为图像文件</h3><p>对图像数据做出修改以后，可以使用toDataURL方法，将Canvas数据重新转化成一般的图像文件形式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertCanvasToImage</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">  image.src = canvas.toDataURL(<span class="string">"image/png"</span>);</span><br><span class="line">  <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码将Canvas数据，转化成PNG data URI。</p>
<h2 id="保存和恢复上下文"><a href="#保存和恢复上下文" class="headerlink" title="保存和恢复上下文"></a>保存和恢复上下文</h2><p>save方法用于保存上下文环境，restore方法用于恢复到上一次保存的上下文环境。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ctx.save(); </span><br><span class="line">ctx.shadowOffsetX = <span class="number">10</span>;</span><br><span class="line">ctx.shadowOffsetY = <span class="number">10</span>;</span><br><span class="line">ctx.shadowBlur = <span class="number">5</span>;</span><br><span class="line">ctx.shadowColor = <span class="string">"rgba(0,0,0,0.5)"</span>;</span><br><span class="line">ctx.fillStyle = <span class="string">"#CC0000"</span>;</span><br><span class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">150</span>,<span class="number">100</span>);</span><br><span class="line">ctx.restore(); </span><br><span class="line">ctx.fillStyle = <span class="string">"#000000"</span>;</span><br><span class="line">ctx.fillRect(<span class="number">180</span>,<span class="number">10</span>,<span class="number">150</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>上面的代码一共绘制了两个矩形，前一个有阴影，后一个没有。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li>David Walsh, <a href="http://davidwalsh.name/convert-canvas-image" target="_blank" rel="noopener">JavaScript Canvas Image Conversion</a></li>
<li>Matt West, <a href="http://blog.teamtreehouse.com/getting-started-with-the-canvas-api" target="_blank" rel="noopener">Getting Started With The Canvas API</a></li>
<li>John Robinson, <a href="http://www.storminthecastle.com/2013/04/06/how-you-can-do-cool-image-effects-using-html5-canvas/" target="_blank" rel="noopener">How You Can Do Cool Image Effects Using HTML5 Canvas</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/08/sample file for grunt/" class="prev">PREV</a><a href="/2018/01/08/basic-network/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://esfak47.github.io">Tony Wang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>